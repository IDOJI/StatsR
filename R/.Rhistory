data = readRDS(list.files(path_save, pattern = "Data___4.Corr", full.names = T))
data$QOL_and_MI_only.df
data$QOL_and_MI_only.df
# combine data
Data_MeanDiff.df = cbind(data$Data, data$QOL_and_MI_only.df)
# combine data
data_2 = cbind(data$Data, data$QOL_and_MI_only.df)
names(data_2)
# ğŸŸ¥Mean difference test: MI  yes / no ###############################################################
## ğŸŸ§Data Load ============================================================================
data = readRDS(list.files(path_save, pattern = "Data___4.Corr", full.names = T))
# combine data
data_2 = cbind(data$Data, data$QOL_and_MI_only.df)
## ğŸŸ§New coloumn : MI group ================================================================
data_2= data_2 %>%
dplyr::mutate(Category_MI_Group = ifelse(Score_MI >= 36, "Yes", "No"))
## ğŸŸ§New coloumn : MI group ================================================================
data_3= data_2 %>%
dplyr::mutate(Category_MI_Group = ifelse(Score_MI >= 36, "Yes", "No"))
# combine data
data_2 = cbind(data$Data, data$QOL_and_MI_only.df)
## ğŸŸ§New coloumn : MI group ================================================================
data_3= data_2 %>%
dplyr::mutate(Category_MI_Group = ifelse(Score_MI >= 36, "Yes", "No"))
## ğŸŸ§Mean diff test ================================================================
ANOVA = Test___MeanDiff(Data = data_3,
Response_Vars = c("Score_MI", "Score_QOL"),
Group_Var = "Category_MI_Group",
Group_Var_Type = "Nominal",
alpha_ANOVA = 0.05,
path_save = path_save)
## ğŸŸ§ Define Response Variables ================================================================
Respose_Vars = c("Score_MI", "Score_QOL")
## ğŸŸ§ Define Response Variables ================================================================
response_vars = c("Score_MI", "Score_QOL")
## ğŸŸ§ Test: Normal ====================================================================
### ğŸŸ¨ Define a function ==============================================================
# ì •ê·œì„± ê²€ì‚¬ í•¨ìˆ˜ ì •ì˜
perform_normality_test <- function(data, group_vars, response_vars) {
results_list <- list()
# ê·¸ë£¹í™”ëœ ë°ì´í„° ìƒì„±
grouped_data <- split(data, data[,group_vars])
# ê° ê·¸ë£¹ë³„ë¡œ ë°˜ë³µ
for(group_name in names(grouped_data)) {
group_data <- grouped_data[[group_name]]
# response_vars ê°ê°ì— ëŒ€í•´ ë°˜ë³µ
for(response_var in response_vars) {
# ë°ì´í„° ì¤€ë¹„
response_data <- group_data[[response_var]]
# ì •ê·œì„± ê²€ì •
if(length(response_data) > 4) { # n > 4ì¸ ê²½ìš°
test_result <- shapiro.test(response_data)
} else { # outlier ì²˜ë¦¬ë¥¼ ìœ„í•œ MJBTest í•¨ìˆ˜ ì‚¬ìš©
test_result <- MJBTest(response_data)
# MJBTestì˜ ê²°ê³¼ì—ì„œ p-value ì¶”ì¶œ (ì˜ˆì‹œëŠ” 'p_value' ì—´ ì´ë¦„ ì‚¬ìš©)
test_result <- list(p.value = test_result$p_value)
}
# ê²°ê³¼ ì €ì¥
result_key <- paste(group_name, response_var, sep = "_")
results_list[[result_key]] <- test_result
}
}
return(results_list)
}
perform_normality_test(data = iris, group_vars = "Species", "Sepal.Length")
test = perform_normality_test(data = iris, group_vars = "Species", "Sepal.Length")
test$setosa_Sepal.Length
test$setosa_Sepal.Length$p.value
## ğŸŸ§ Test: Normal ====================================================================
### ğŸŸ¨ Define a function ==============================================================
# ì •ê·œì„± ê²€ì‚¬ í•¨ìˆ˜ ì •ì˜
# ì •ê·œì„± ê²€ì‚¬ í•¨ìˆ˜ ì •ì˜
perform_normality_test <- function(data, group_vars = NULL, response_vars = NULL) {
results_list <- list()
# response_varsê°€ NULLì¼ ê²½ìš°, group_varsë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ë³€ìˆ˜ë“¤ë¡œ ì„¤ì •
if(is.null(response_vars)) {
if(!is.null(group_vars)) {
response_vars <- setdiff(names(data), group_vars)
} else {
response_vars <- names(data) # ëª¨ë“  ë³€ìˆ˜ë¥¼ response_varsë¡œ ì„¤ì •
}
}
# group_varsì™€ response_varsê°€ ëª¨ë‘ NULLì¼ ê²½ìš°ì˜ ì²˜ë¦¬ëŠ” ìœ„ì˜ ì½”ë“œë¡œ ì¶©ë¶„
# ê·¸ë£¹í™”ëœ ë°ì´í„° ìƒì„±
if(!is.null(group_vars)) {
grouped_data <- split(data, data[,group_vars])
} else {
grouped_data <- list("AllData" = data) # ì „ì²´ ë°ì´í„°ë¥¼ í•˜ë‚˜ì˜ ê·¸ë£¹ìœ¼ë¡œ ì²˜ë¦¬
}
# ê° ê·¸ë£¹ë³„ë¡œ ë°˜ë³µ
for(group_name in names(grouped_data)) {
group_data <- grouped_data[[group_name]]
# response_vars ê°ê°ì— ëŒ€í•´ ë°˜ë³µ
for(response_var in response_vars) {
# ë°ì´í„° ì¤€ë¹„
response_data <- group_data[[response_var]]
# ì •ê·œì„± ê²€ì •
if(length(response_data) > 4) { # n > 4ì¸ ê²½ìš°
test_result <- shapiro.test(response_data)
} else { # outlier ì²˜ë¦¬ë¥¼ ìœ„í•œ MJBTest í•¨ìˆ˜ ì‚¬ìš©
test_result <- MJBTest(response_data)
# MJBTestì˜ ê²°ê³¼ì—ì„œ p-value ì¶”ì¶œ (ì˜ˆì‹œëŠ” 'p_value' ì—´ ì´ë¦„ ì‚¬ìš©)
test_result <- list(p.value = test_result$p_value)
}
# ê²°ê³¼ ì €ì¥
result_key <- paste(group_name, response_var, sep = "_")
results_list[[result_key]] <- test_result
}
}
return(results_list)
}
perform_normality_test(iris)
perform_normality_test(iris, "Species")
test = perform_normality_test(iris, "Species")
test[[1]]
## ğŸŸ§ Test: Normal ====================================================================
### ğŸŸ¨ Define a function ==============================================================
# ì •ê·œì„± ê²€ì‚¬ í•¨ìˆ˜ ì •ì˜
perform_normality_test <- function(data, group_var, response_vars) {
results_list <- list()
# response_varsê°€ NULLì´ ì•„ë‹Œì§€ í™•ì¸, ì•„ë‹ˆë¼ë©´ ì „ì²´ ë³€ìˆ˜ ì¤‘ group_varë¥¼ ì œì™¸í•œ ê²ƒì„ ì‚¬ìš©
if(is.null(response_vars)) {
response_vars <- setdiff(names(data), group_var)
}
# response_vars ê°ê°ì— ëŒ€í•œ ë¦¬ìŠ¤íŠ¸ë¥¼ ì´ˆê¸°í™”
for(response_var in response_vars) {
results_list[[response_var]] <- list()
}
# group_varì— ë”°ë¼ ë°ì´í„°ë¥¼ ê·¸ë£¹í™”
grouped_data <- split(data, data[,group_var])
# ê° response_varì— ëŒ€í•´ ë°˜ë³µ
for(response_var in response_vars) {
# ê° ê·¸ë£¹ë³„ë¡œ ë°˜ë³µ
for(group_name in names(grouped_data)) {
group_data <- grouped_data[[group_name]]
response_data <- group_data[[response_var]]
# ì •ê·œì„± ê²€ì • ìˆ˜í–‰
test_result <- if(length(response_data) > 4) {
# n > 4ì¸ ê²½ìš° shapiro.test ì‚¬ìš©
shapiro.test(response_data)
} else {
# outlier ì²˜ë¦¬ë¥¼ ìœ„í•œ MJBTest í•¨ìˆ˜ ì‚¬ìš©, ì˜ˆì‹œì—ì„œëŠ” p.valueë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒìœ¼ë¡œ ê°€ì •
test_result <- MJBTest(response_data)
list(p.value = test_result$p_value)
}
# ê° response_varì— ëŒ€í•œ ê²°ê³¼ì— ê·¸ë£¹ë³„ ê²°ê³¼ ì¶”ê°€
results_list[[response_var]][[group_name]] <- test_result
}
}
return(results_list)
}
## ğŸŸ§ Test: Normal ====================================================================
### ğŸŸ¨ Define a function ==============================================================
# ì •ê·œì„± ê²€ì‚¬ í•¨ìˆ˜ ì •ì˜
perform_normality_test <- function(data, group_var, response_vars) {
results_list <- list()
# response_varsê°€ NULLì´ ì•„ë‹Œì§€ í™•ì¸, ì•„ë‹ˆë¼ë©´ ì „ì²´ ë³€ìˆ˜ ì¤‘ group_varë¥¼ ì œì™¸í•œ ê²ƒì„ ì‚¬ìš©
if(is.null(response_vars)) {
response_vars <- setdiff(names(data), group_var)
}
# response_vars ê°ê°ì— ëŒ€í•œ ë¦¬ìŠ¤íŠ¸ë¥¼ ì´ˆê¸°í™”
for(response_var in response_vars) {
results_list[[response_var]] <- list()
}
# group_varì— ë”°ë¼ ë°ì´í„°ë¥¼ ê·¸ë£¹í™”
grouped_data <- split(data, data[,group_var])
# ê° response_varì— ëŒ€í•´ ë°˜ë³µ
for(response_var in response_vars) {
# ê° ê·¸ë£¹ë³„ë¡œ ë°˜ë³µ
for(group_name in names(grouped_data)) {
group_data <- grouped_data[[group_name]]
response_data <- group_data[[response_var]]
# ì•„ì›ƒë¼ì´ì–´ ê²€ì¶œ
Q1 <- quantile(response_data, 0.25)
Q3 <- quantile(response_data, 0.75)
IQR <- Q3 - Q1
outlier_exists <- any(response_data < (Q1 - 1.5 * IQR) | response_data > (Q3 + 1.5 * IQR))
# ì •ê·œì„± ê²€ì • ìˆ˜í–‰
if(outlier_exists) {
# ì•„ì›ƒë¼ì´ì–´ê°€ ìˆì„ ê²½ìš° MJBTest í•¨ìˆ˜ ì‚¬ìš©
test_result <- MJBTest(response_data)
# MJBTest ê²°ê³¼ì—ì„œ p-value ì¶”ì¶œ, ì—¬ê¸°ì„œëŠ” p_value ì—´ì„ ë°˜í™˜í•œë‹¤ê³  ê°€ì •
test_result <- list(p.value = test_result$p_value)
} else {
# ì•„ì›ƒë¼ì´ì–´ê°€ ì—†ì„ ê²½ìš° shapiro.test ì‚¬ìš©
test_result <- shapiro.test(response_data)
}
# ê° response_varì— ëŒ€í•œ ê²°ê³¼ì— ê·¸ë£¹ë³„ ê²°ê³¼ ì¶”ê°€
results_list[[response_var]][[group_name]] <- test_result
}
}
return(results_list)
}
perform_normality_test(iris, "Species")
perform_normality_test(iris, "Species", response_vars = "Sepal.length")
perform_normality_test(iris, "Species", response_vars = "sepal.length")
names(iris)
perform_normality_test(iris, "Species", response_vars = "Sepal.Length")
test = perform_normality_test(iris, "Species", response_vars = "Sepal.Length")
test$Sepal.Length
test$Sepal.Length$setosa
## ğŸŸ§ Test: Normal ====================================================================
### ğŸŸ¨ Define a function ==============================================================
perform_normality_test <- function(data, group_var, response_vars) {
results_df <- data.frame()
# response_varsê°€ NULLì´ ì•„ë‹ˆë¼ë©´ í•´ë‹¹ ë³€ìˆ˜ë§Œ ì‚¬ìš©, NULLì´ë¼ë©´ group_varë¥¼ ì œì™¸í•œ ëª¨ë“  ë³€ìˆ˜ ì‚¬ìš©
if(is.null(response_vars)) {
response_vars <- setdiff(names(data), group_var)
} else if (!is.character(response_vars)) { # response_varsê°€ ë¬¸ìì—´ì´ ì•„ë‹Œ ê²½ìš° ë¬¸ìì—´ ë²¡í„°ë¡œ ë³€í™˜
response_vars <- as.character(response_vars)
}
# response_varsê°€ ë‹¨ì¼ ë¬¸ìì—´ì´ë©´ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜
if(!is.list(response_vars)) {
response_vars <- list(response_vars)
}
# group_varì— ë”°ë¼ ë°ì´í„°ë¥¼ ê·¸ë£¹í™”
grouped_data <- split(data, data[,group_var])
# ê° response_varì— ëŒ€í•´ ë°˜ë³µ
for(response_var in response_vars) {
# ê° ê·¸ë£¹ë³„ë¡œ ë°˜ë³µ
for(group_name in names(grouped_data)) {
group_data <- grouped_data[[group_name]]
response_data <- group_data[[response_var]]
# ì•„ì›ƒë¼ì´ì–´ ê²€ì¶œ
Q1 <- quantile(response_data, 0.25, na.rm = TRUE)
Q3 <- quantile(response_data, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1
outlier_exists <- any(response_data < (Q1 - 1.5 * IQR) | response_data > (Q3 + 1.5 * IQR), na.rm = TRUE)
# ì •ê·œì„± ê²€ì • ìˆ˜í–‰
if(outlier_exists) {
# ì•„ì›ƒë¼ì´ì–´ê°€ ìˆì„ ê²½ìš° MJBTest í•¨ìˆ˜ ì‚¬ìš©, ì—¬ê¸°ì„œëŠ” ì˜ˆì‹œë¡œ ë‹¨ìˆœí™”
test_method <- "MJBTest"
test_result <- list(statistic=NA, p.value=runif(1)) # ì„ì‹œ ê²°ê³¼
} else {
# ì•„ì›ƒë¼ì´ì–´ê°€ ì—†ì„ ê²½ìš° shapiro.test ì‚¬ìš©
test_result <- shapiro.test(response_data)
test_method <- "Shapiro-Wilk"
}
# ê²°ê³¼ë¥¼ ë°ì´í„° í”„ë ˆì„ì— ì¶”ê°€
temp_df <- data.frame(
"NormalityTestMethod" = test_method,
"Group" = group_name,
"n_obs" = length(response_data),
"Statistic" = test_result$statistic,
"P_Value" = test_result$p.value,
stringsAsFactors = FALSE
)
results_df <- rbind(results_df, temp_df)
}
}
# ê²°ê³¼ ë°˜í™˜
return(results_df)
}
# ì‚¬ìš© ì˜ˆì‹œ
results <- perform_normality_test(iris, "Species", response_vars = "Sepal.Length")
print(results)
## ğŸŸ§ Test: Normal ====================================================================
### ğŸŸ¨ Define a function ==============================================================
perform_normality_test <- function(data, group_var, response_vars) {
results_df <- data.frame()
# response_varsê°€ NULLì´ ì•„ë‹ˆë¼ë©´ í•´ë‹¹ ë³€ìˆ˜ë§Œ ì‚¬ìš©, NULLì´ë¼ë©´ group_varë¥¼ ì œì™¸í•œ ëª¨ë“  ë³€ìˆ˜ ì‚¬ìš©
if(is.null(response_vars)) {
response_vars <- setdiff(names(data), group_var)
} else if (!is.character(response_vars)) { # response_varsê°€ ë¬¸ìì—´ì´ ì•„ë‹Œ ê²½ìš° ë¬¸ìì—´ ë²¡í„°ë¡œ ë³€í™˜
response_vars <- as.character(response_vars)
}
# response_varsê°€ ë‹¨ì¼ ë¬¸ìì—´ì´ë©´ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜
if(!is.list(response_vars)) {
response_vars <- list(response_vars)
}
# group_varì— ë”°ë¼ ë°ì´í„°ë¥¼ ê·¸ë£¹í™”
grouped_data <- split(data, data[,group_var])
# ê° response_varì— ëŒ€í•´ ë°˜ë³µ
for(response_var in response_vars) {
# ê° ê·¸ë£¹ë³„ë¡œ ë°˜ë³µ
for(group_name in names(grouped_data)) {
group_data <- grouped_data[[group_name]]
response_data <- group_data[[response_var]]
# ì•„ì›ƒë¼ì´ì–´ ê²€ì¶œ
Q1 <- quantile(response_data, 0.25, na.rm = TRUE)
Q3 <- quantile(response_data, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1
outlier_exists <- any(response_data < (Q1 - 1.5 * IQR) | response_data > (Q3 + 1.5 * IQR), na.rm = TRUE)
# ì •ê·œì„± ê²€ì • ìˆ˜í–‰
if(outlier_exists) {
# ì•„ì›ƒë¼ì´ì–´ê°€ ìˆì„ ê²½ìš° MJBTest í•¨ìˆ˜ ì‚¬ìš©, ì—¬ê¸°ì„œëŠ” ì˜ˆì‹œë¡œ ë‹¨ìˆœí™”
test_result <- MJBTest(response_data)
} else {
# ì•„ì›ƒë¼ì´ì–´ê°€ ì—†ì„ ê²½ìš° shapiro.test ì‚¬ìš©
test_result <- shapiro.test(response_data)
test_method <- "Shapiro-Wilk"
}
# ê²°ê³¼ë¥¼ ë°ì´í„° í”„ë ˆì„ì— ì¶”ê°€
temp_df <- data.frame(
"NormalityTestMethod" = test_method,
"Group" = group_name,
"n_obs" = length(response_data),
"Statistic" = test_result$statistic,
"P_Value" = test_result$p.value,
stringsAsFactors = FALSE
)
results_df <- rbind(results_df, temp_df)
}
}
# ê²°ê³¼ ë°˜í™˜
return(results_df)
}
# ì‚¬ìš© ì˜ˆì‹œ
results <- perform_normality_test(iris, "Species", response_vars = "Sepal.Length")
print(results)
?leveneTest
?fligner.test
## ğŸŸ§ Test: Normal ====================================================================
### ğŸŸ¨ Define a function ==============================================================
perform_normality_test <- function(data, group_var, response_vars) {
results_df <- data.frame()
if(is.null(response_vars)) {
response_vars <- setdiff(names(data), group_var)
} else if (!is.character(response_vars)) {
response_vars <- as.character(response_vars)
}
if(!is.list(response_vars)) {
response_vars <- list(response_vars)
}
grouped_data <- split(data, data[,group_var])
for(response_var in response_vars) {
for(group_name in names(grouped_data)) {
group_data <- grouped_data[[group_name]]
response_data <- group_data[[response_var], drop = TRUE]
## ğŸŸ§ Test: Normal ====================================================================
### ğŸŸ¨ Define a function ==============================================================
perform_normality_test <- function(data, group_var, response_vars) {
results_df <- data.frame()
if(is.null(response_vars)) {
response_vars <- setdiff(names(data), group_var)
} else if (!is.character(response_vars)) {
response_vars <- as.character(response_vars)
}
if(!is.list(response_vars)) {
response_vars <- list(response_vars)
}
grouped_data <- split(data, data[,group_var])
for(response_var in response_vars) {
for(group_name in names(grouped_data)) {
group_data <- grouped_data[[group_name]]
response_data <- group_data[[response_var], drop = TRUE]
## ğŸŸ§ Test: Normal ====================================================================
### ğŸŸ¨ Define a function ==============================================================
perform_normality_test <- function(data, group_var, response_vars, alpha = 0.05) {
final_results_list <- list()  # ê²°ê³¼ë¥¼ ì €ì¥í•  ë¹ˆ ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
# ë§Œì•½ response_varsê°€ NULLì´ë¼ë©´, ê·¸ë£¹ ë³€ìˆ˜ë¥¼ ì œì™¸í•œ ëª¨ë“  ë³€ìˆ˜ë¥¼ response_varsë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
if(is.null(response_vars)) {
response_vars <- setdiff(names(data), group_var)
} else if (!is.character(response_vars)) {  # response_varsê°€ ë¬¸ìì—´ì´ ì•„ë‹ˆë¼ë©´, ë¬¸ìì—´ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
response_vars <- as.character(response_vars)
}
# response_varsê°€ ë¦¬ìŠ¤íŠ¸ê°€ ì•„ë‹ˆë¼ë©´, ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
if(!is.list(response_vars)) {
response_vars <- list(response_vars)
}
# ë°ì´í„°ë¥¼ ê·¸ë£¹í™”í•©ë‹ˆë‹¤.
grouped_data <- split(data, data[,group_var])
adjusted_alpha <- alpha / length(grouped_data)  # ì¡°ì •ëœ ìœ ì˜ìˆ˜ì¤€ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
# ê° response ë³€ìˆ˜ì— ëŒ€í•´ ë°˜ë³µí•©ë‹ˆë‹¤.
for(response_var in response_vars) {
results_df <- data.frame()  # ê²°ê³¼ë¥¼ ì €ì¥í•  ë¹ˆ ë°ì´í„°í”„ë ˆì„ì„ ìƒì„±í•©ë‹ˆë‹¤.
all_normal <- TRUE  # ëª¨ë“  ê·¸ë£¹ì´ ì •ê·œë¶„í¬ë¥¼ ë”°ë¥´ëŠ”ì§€ ì—¬ë¶€ë¥¼ ì¶”ì í•©ë‹ˆë‹¤.
# ê° ê·¸ë£¹ì— ëŒ€í•´ ë°˜ë³µí•©ë‹ˆë‹¤.
for(group_name in names(grouped_data)) {
group_data <- grouped_data[[group_name]]  # í˜„ì¬ ê·¸ë£¹ì˜ ë°ì´í„°ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
response_data <- group_data[[response_var]]  # í˜„ì¬ response ë³€ìˆ˜ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
# ì´ìƒì¹˜ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
Q1 <- quantile(response_data, 0.25, na.rm = TRUE)
Q3 <- quantile(response_data, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1
outlier_exists <- any(response_data < (Q1 - 1.5 * IQR) | response_data > (Q3 + 1.5 * IQR), na.rm = TRUE)
# ì´ìƒì¹˜ê°€ ìˆìœ¼ë©´ MJBTestë¥¼ ìˆ˜í–‰í•˜ê³ , ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ Shapiro-Wilk í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.
if(outlier_exists) {
test_result <- MJBTest(response_data)
test_method <- test_result$Test[1]
statistic <- test_result$MJB_statistic[1]
p_value <- test_result$p_value[1]
} else {
test_result <- shapiro.test(response_data)
test_method <- "Shapiro-Wilk"
statistic <- test_result$statistic
p_value <- test_result$p.value
}
# ìœ ì˜ìˆ˜ì¤€ì— ë”°ë¼ ê²°ê³¼ë¥¼ í‰ê°€í•©ë‹ˆë‹¤.
significance <- if(p_value < adjusted_alpha / 2) "***" else if(p_value < adjusted_alpha / 1.5) "**" else if(p_value < adjusted_alpha) "*" else ""
if(p_value < adjusted_alpha) all_normal <- FALSE  # ìœ ì˜ìˆ˜ì¤€ë³´ë‹¤ ì‘ì€ p-ê°’ì´ ìˆìœ¼ë©´ all_normalì„ FALSEë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
# ê²°ê³¼ë¥¼ ë°ì´í„°í”„ë ˆì„ì— ì¶”ê°€í•©ë‹ˆë‹¤.
temp_df <- data.frame(
NormalityTestMethod = test_method,
Group = group_name,
n_obs = sum(!is.na(response_data)),
Statistic = statistic,
P_Value = p_value,
Significance = significance,
stringsAsFactors = FALSE
)
results_df <- rbind(results_df, temp_df)  # ê²°ê³¼ë¥¼ ê²°ê³¼ ë°ì´í„°í”„ë ˆì„ì— ì¶”ê°€í•©ë‹ˆë‹¤.
}
# ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ì— í˜„ì¬ response ë³€ìˆ˜ì˜ ê²°ê³¼ì™€ ì •ê·œì„± ì—¬ë¶€ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
final_results_list[[response_var]] <- list(results_df, is.normal = all_normal)
}
return(final_results_list)  # ìµœì¢… ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
}
# ì‚¬ìš© ì˜ˆì‹œ
results <- perform_normality_test(iris, "Species", response_vars = "Sepal.Length", alpha = 0.05)
print(results$`Sepal.Length`[[1]]) # ì •ê·œì„± ê²€ì • ê²°ê³¼ ë°ì´í„°í”„ë ˆì„ ì¶œë ¥
print(results$`Sepal.Length`[[2]]) # ëª¨ë“  ê·¸ë£¹ì— ëŒ€í•œ ì •ê·œì„± ì§„ë‹¨ ì¶œë ¥
## ğŸŸ§Homoscesdasticity ================================================================
### ğŸŸ¨ define function ==============================================================
perform_homogeneity_of_variance_test <- function(data, group_var, response_vars, normality_results, alpha = 0.05) {
final_results <- list()  # ìµœì¢… ê²°ê³¼ë¥¼ ì €ì¥í•  ë¹ˆ ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
for(response_var in response_vars) {  # ê° response ë³€ìˆ˜ì— ëŒ€í•´ ë°˜ë³µí•©ë‹ˆë‹¤.
group_data <- data[, c(group_var, response_var)]  # ê·¸ë£¹ ë³€ìˆ˜ì™€ response ë³€ìˆ˜ë¡œ ë°ì´í„°ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
groups <- unique(data[[group_var]])  # ê·¸ë£¹ ë³€ìˆ˜ì˜ ê³ ìœ í•œ ê°’ë“¤ì„ ì„ íƒí•©ë‹ˆë‹¤.
# ì •ê·œì„± ê²€ì • ê²°ê³¼ ì‚¬ìš©
normal <- normality_results[[response_var]][[2]]$is.normal  # ì •ê·œì„± ê²€ì • ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
if(normal) {  # ë§Œì•½ ì •ê·œì„±ì„ ë§Œì¡±í•œë‹¤ë©´,
# ì •ê·œì„±ì„ ë§Œì¡±í•˜ëŠ” ê²½ìš°
if(length(groups) == 2) {
# F ê²€ì •
test_result <- var.test(group_data[[response_var]] ~ group_data[[group_var]])  # F ê²€ì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
} else {
# Bartlett ê²€ì •
test_result <- bartlett.test(group_data[[response_var]] ~ group_data[[group_var]])  # Bartlett ê²€ì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
}
} else {  # ì •ê·œì„±ì„ ë§Œì¡±í•˜ì§€ ì•ŠëŠ” ê²½ìš°
Q1 <- quantile(group_data[[response_var]], 0.25, na.rm = TRUE)  # 1ì‚¬ë¶„ìœ„ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
Q3 <- quantile(group_data[[response_var]], 0.75, na.rm = TRUE)  # 3ì‚¬ë¶„ìœ„ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
IQR <- Q3 - Q1  # IQRì„ ê³„ì‚°í•©ë‹ˆë‹¤.
outlier_exists <- any(group_data[[response_var]] < (Q1 - 1.5 * IQR) | group_data[[response_var]] > (Q3 + 1.5 * IQR), na.rm = TRUE)  # ì´ìƒì¹˜ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.
if(outlier_exists) {
# Fligner-Killeen ê²€ì •
test_result <- fligner.test(group_data[[response_var]] ~ group_data[[group_var]])  # Fligner-Killeen ê²€ì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
} else {
# Levene ê²€ì •
test_result <- leveneTest(group_data[[response_var]] ~ group_data[[group_var]], center = median)  # Levene ê²€ì •ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
}
}
# ê²°ê³¼ ì €ì¥
final_results[[response_var]] <- list(
test_name = deparse(test_result$method),  # ê²€ì • ë°©ë²•ì„ ì €ì¥í•©ë‹ˆë‹¤.
statistic = test_result$statistic,  # ê²€ì • í†µê³„ëŸ‰ì„ ì €ì¥í•©ë‹ˆë‹¤.
p_value = test_result$p.value,  # p-ê°’ì„ ì €ì¥í•©ë‹ˆë‹¤.
df = test_result$parameter,  # ììœ ë„ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
significance = if(test_result$p.value < alpha) "Significant" else "Not significant"  # ìœ ì˜ìˆ˜ì¤€ì— ë”°ë¼ ê²°ê³¼ë¥¼ í‰ê°€í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤.
)
}
return(final_results)  # ìµœì¢… ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
}
### ğŸŸ¨ test ==============================================================
perform_normality_test(data = iris, group_var = "Species", response_vars = c("Sepal.Length", "Sepal.Width"))
### ğŸŸ¨ test ==============================================================
test = perform_normality_test(data = iris, group_var = "Species", response_vars = c("Sepal.Length", "Sepal.Width"))
perform_normality_test <- function(data, group_var, response_vars, alpha = 0.05) {
final_results_list <- list()
if(is.null(response_vars)) {
response_vars <- setdiff(names(data), group_var)
}
grouped_data <- split(data, data[,group_var])
for(response_var in response_vars) {
results_df <- data.frame()
is_normal <- TRUE
for(group_name in names(grouped_data)) {
group_data <- grouped_data[[group_name]]
if(!response_var %in% names(group_data)) {
next
}
response_data <- group_data[[response_var]]
# ì•„ì›ƒë¼ì´ì–´ ê²€ì¶œ
Q1 <- quantile(response_data, 0.25, na.rm = TRUE)
Q3 <- quantile(response_data, 0.75, na.rm = TRUE)
IQR <- Q3 - Q1
outlier_exists <- any(response_data < (Q1 - 1.5 * IQR) | response_data > (Q3 + 1.5 * IQR), na.rm = TRUE)
# ì •ê·œì„± ê²€ì • ìˆ˜í–‰
test_result <- if(length(na.omit(response_data)) > 4) {
if(outlier_exists) {
# MJBTest í•¨ìˆ˜ ì‚¬ìš©
MJBTest(response_data)
} else {
# shapiro.test ì‚¬ìš©
shapiro.test(response_data)
}
} else {
# ë°ì´í„° í¬ì¸íŠ¸ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŒ
list(statistic=NA, p.value=NA)
}
# ê²°ê³¼ ë°ì´í„° í”„ë ˆì„ì— ì¶”ê°€
temp_df <- data.frame(
Group = group_name,
TestMethod = if(outlier_exists) "MJBTest" else "Shapiro-Wilk",
Statistic = test_result$statistic,
P_Value = test_result$p.value,
stringsAsFactors = FALSE
)
results_df <- rbind(results_df, temp_df)
if(is.na(test_result$p.value) || test_result$p.value < alpha) {
is_normal <- FALSE
}
}
final_results_list[[response_var]] <- list(DataFrame = results_df, is.normal = is_normal)
}
return(final_results_list)
}
# MJBTest í•¨ìˆ˜ëŠ” ì˜ˆì‹œë¥¼ ìœ„í•´ ë‹¨ìˆœí™”ëœ í˜•íƒœë¡œ êµ¬í˜„ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
# ì‹¤ì œ ì‚¬ìš©ì—ì„œëŠ” í•´ë‹¹ í•¨ìˆ˜ì˜ êµ¬í˜„ì´ í•„ìš”í•©ë‹ˆë‹¤.
# ì‚¬ìš© ì˜ˆì‹œ
test <- perform_normality_test(data = iris, group_var = "Species", response_vars = c("Sepal.Length", "Sepal.Width"))
